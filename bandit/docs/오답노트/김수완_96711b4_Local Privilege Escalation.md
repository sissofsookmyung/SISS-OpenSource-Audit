## ê°œìš”

- **ì»¤ë°‹ í•´ì‹œ:** 0274a4f3b403162a37a10f199c989f3727ed3ad4
- **ë°œê²¬ ë‚ ì§œ:** committed on Jan 13, 2023
- **ë¶„ì„ ëŒ€ìƒ**: sudoedit: do not permit editor arguments to include "--â€
- **ê´€ë ¨ CVE**: CVE-2023-22809

## 1. ì–´ë–¤ ë³´ì•ˆ ë¬¸ì œ?

- sudoì˜ sudoedit ê¸°ëŠ¥(ë˜ëŠ” sudo -e)ì„ ì‚¬ìš©í•  ë•Œ, sudoers íŒŒì¼ì— í—ˆìš©ë˜ì§€ ì•Šì€ **ì„ì˜ì˜ íŒŒì¼**ì„ â€˜root ê¶Œí•œìœ¼ë¡œ í¸ì§‘â€™í•  ìˆ˜ ìˆëŠ” ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹(LPE) ì·¨ì•½ì 
- sudoeditëŠ” ì›ë˜ root ê¶Œí•œìœ¼ë¡œ ì§ì ‘ íŒŒì¼ì„ í¸ì§‘í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,

1. 

 íŒŒì¼ì„ `/var/tmp` ê°™ì€ ì„ì‹œ ìœ„ì¹˜ì— ì‚¬ìš©ìì˜ ê¶Œí•œìœ¼ë¡œ ë³µì‚¬
2.  ì‚¬ìš©ìê°€ ì¼ë°˜ í¸ì§‘ê¸°ë¡œ ì´ 'ì„ì‹œ íŒŒì¼'ì„ ìˆ˜ì •
3.  í¸ì§‘ì´ ëë‚˜ë©´, ìˆ˜ì •ëœ 'ì„ì‹œ íŒŒì¼'ì„ ì›ë³¸ ìœ„ì¹˜(ì˜ˆ: /etc/httpd.conf)ë¡œ ë‹¤ì‹œ ë®ì–´ì”€

**ì·¨ì•½ì **

- ê³µê²©ìê°€ 'sudoedit -- /etc/passwd'ì²˜ëŸ¼ '--' ë¬¸ìë¥¼ íŒŒì¼ëª…ê³¼ í•¨ê»˜ ì…ë ¥í•˜ë©´, 'sudo'ì˜ argument parserê°€ '--'ë¥¼ "ì—¬ê¸°ì„œë¶€í„°ëŠ” ì˜µì…˜ì´ ì•„ë‹ˆë¼ íŒŒì¼ëª…"ì´ë¼ëŠ” ëœ»ì˜ ë©”íƒ€ ë¬¸ìë¡œ ì˜ëª» í•´ì„í•¨

**ê²°ê³¼**
  - â€™--â€™ ë’¤ì— ì˜¤ëŠ” íŒŒì¼(ì˜ˆ: /etc/passwd)ì€ â€˜sudoedit'ì˜ ì•ˆì „í•œ 'ì„ì‹œ íŒŒì¼ ë³µì‚¬' ë¡œì§ì„ ìš°íšŒí•˜ê³ , í¸ì§‘í•  íŒŒì¼ ëª©ë¡ì— ë‚ ê²ƒìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŒ

  - ì´ë¡œ ì¸í•´ â€˜sudoers' ì •ì±…ìƒ í¸ì§‘ ê¶Œí•œì´ ì—†ëŠ” ì‚¬ìš©ìë¼ë„ â€˜/etc/passwdâ€™ ê°™ì€ ë¯¼ê°í•œ ì‹œìŠ¤í…œ íŒŒì¼ì„ â€˜rootâ€™ ê¶Œí•œìœ¼ë¡œ ì§ì ‘ ì—´ì–´ì„œ ìˆ˜ì •í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŒ

## 2. ì™œ ë°œìƒí–ˆëŠ”ì§€?

- **ì…ë ¥ ê²€ì¦ ë¶€ì¡±: â€˜**sudoâ€™ì˜ ë©”ì¸ ì¸ìˆ˜ íŒŒì‹± ë¡œì§ì´ â€˜sudoeditâ€™ ëª¨ë“œì—ì„œ â€˜--â€™ ë¬¸ìë¥¼ ë§Œë‚¬ì„ ë•Œì˜ ì—£ì§€ ì¼€ì´ìŠ¤ë¥¼ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ëª»í–ˆìŒ
- **ë¡œì§ ê²°í•¨: â€˜**sudoeditâ€™ëŠ” ì‚¬ìš©ìê°€ ì§€ì •í•œ íŒŒì¼ê³¼ í¸ì§‘ê¸°ì— ì „ë‹¬í•  ì¸ìˆ˜ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•´ì•¼ í•¨
  > í•˜ì§€ë§Œ â€˜--â€™ ë¬¸ìë¡œ ì¸í•´ ì´ êµ¬ë¶„ì´ ë¬´ë„ˆì¡Œê³ , ê²€ì¦ë˜ì§€ ì•Šì€ íŒŒì¼ ê²½ë¡œê°€ í¸ì§‘ ëª©ë¡ìœ¼ë¡œ ë°”ë¡œ ì „ë‹¬ë˜ëŠ” ê²½ë¡œ ìš°íšŒ(Path Traversal)ì™€ ìœ ì‚¬í•œ ë¬¸ì œê°€ ë°œìƒ

## 3. ì–´ë–»ê²Œ í•´ê²°? (Diff ë¶„ì„)

- **íŒŒì¼**: â€˜plugins/sudoers/parse.câ€™

``` diff
--- a/plugins/sudoers/parse.c
+++ b/plugins/sudoers/parse.c
@@ -744,7 +744,14 @@ parse_args(int argc, char **argv, int old_optind,
            }

            /* Handle "--" specified by user. */
-           if (strcmp(*av, "--") == 0) {
+           if (ISSET(sudo_mode, MODE_EDIT) && strcmp(*av, "--") == 0) {
+               /*
+                * The "sudoedit -- file" syntax is ambiguous.
+                * Disallow it to avoid surprises.
+                */
+               errorx(1, U_("sudoedit does not support the -- option"));
+           }
+           if (strcmp(*av, "--") == 0) {
                /* Stop parsing args, everything after is a command. */
                SET(settings, CMND_SAW_DASH_DASH);
                av++;
````

- **í•µì‹¬ ë³€ê²½:** sudoedit ëª¨ë“œì¼ ë•Œ(ISSET(sudo_mode, MODE_EDIT)) - ë¬¸ìë¥¼ ë§Œë‚˜ë©´, ì´ë¥¼ "ì¸ìˆ˜ íŒŒì‹± ì¢…ë£Œ"ë¡œ ì²˜ë¦¬í•˜ë˜ ê¸°ì¡´ ë¡œì§ ì´ì „ì— **ìƒˆë¡œìš´ ê²€ì‚¬ ë¡œì§ì„ ì¶”ê°€**
- **ìƒˆë¡œìš´ ë¡œì§:**
  1. í˜„ì¬ sudoedit ëª¨ë“œì¸ì§€ í™•ì¸
  2. ì´ë•Œ ì‚¬ìš©ìê°€ -ë¥¼ ì…ë ¥í–ˆë‹¤ë©´, "sudoedit does not support the -- optionâ€ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê³  ì¦‰ì‹œ ì¢…ë£Œ(exit(1))
- **ì˜ë¯¸:** sudoedit ëª¨ë“œì—ì„œëŠ” ëª¨í˜¸í•¨ì„ ìœ ë°œí•  ìˆ˜ ìˆëŠ” - ë©”íƒ€ ë¬¸ì ìì²´ë¥¼ ì•„ì˜ˆ ê¸ˆì§€ì‹œí‚´ìœ¼ë¡œì¨, ê³µê²©ìê°€ íŒŒì‹± ë¡œì§ì„ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ê²½ë¡œë¥¼ ì›ì²œ ì°¨ë‹¨



### ğŸ“š ì°¸ê³  ìë£Œ

- **ì»¤ë°‹:** git show 0274a4f
- **CVE:** [NVD - CVE-2023-22809](https://nvd.nist.gov/vuln/search#/nvd/home?keyword=CVE-2023-22809&resultType=records)
- **ìµœì´ˆ ë¶„ì„:** [Synacktiv Blog: Sudoedit vulnerability (CVE-2023-22809)](https://www.synacktiv.com/sites/default/files/2023-01/sudo-CVE-2023-22809.pdf)
